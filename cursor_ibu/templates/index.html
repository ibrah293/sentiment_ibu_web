<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Analysis & Emotion Detection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group select,
        .form-group textarea,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group select:focus,
        .form-group textarea:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }

        .result-item {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .result-label {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 1.1rem;
            color: #333;
        }

        .confidence-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            transition: width 0.3s ease;
        }

        .sentiment-positive {
            color: #28a745;
            font-weight: 600;
        }

        .sentiment-negative {
            color: #dc3545;
            font-weight: 600;
        }

        .sentiment-neutral {
            color: #6c757d;
            font-weight: 600;
        }

        .emotion-joy { color: #ffc107; }
        .emotion-sadness { color: #17a2b8; }
        .emotion-anger { color: #dc3545; }
        .emotion-fear { color: #6f42c1; }
        .emotion-surprise { color: #fd7e14; }
        .emotion-disgust { color: #20c997; }
        .emotion-neutral { color: #6c757d; }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .comparison-section {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .batch-section {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .batch-input {
            margin-bottom: 20px;
        }

        .batch-results {
            max-height: 400px;
            overflow-y: auto;
        }

        .database-section {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .database-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .history-table th,
        .history-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .history-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .history-table tr:hover {
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #dc3545;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #28a745;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 10px;
            }

            .database-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Sentiment Analysis & Emotion Detection</h1>
            <p>Advanced AI-powered text analysis with database storage and analytics</p>
        </div>

        <div class="main-content">
            <!-- Sentiment Analysis Card -->
            <div class="card">
                <h2>üìä Sentiment Analysis</h2>
                <form id="sentimentForm">
                    <div class="form-group">
                        <label for="sentimentText">Enter your text:</label>
                        <textarea id="sentimentText" placeholder="Type your text here for sentiment analysis..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="sentimentModel">Select Model:</label>
                        <select id="sentimentModel">
                            <option value="logistic_regression">Logistic Regression</option>
                            <option value="random_forest">Random Forest</option>
                            <option value="naive_bayes">Naive Bayes</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Analyze Sentiment</button>
                </form>
                <div id="sentimentResults" class="results" style="display: none;"></div>
            </div>

            <!-- Emotion Detection Card -->
            <div class="card">
                <h2>üòä Emotion Detection</h2>
                <form id="emotionForm">
                    <div class="form-group">
                        <label for="emotionText">Enter your text:</label>
                        <textarea id="emotionText" placeholder="Type your text here for emotion detection..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="emotionModel">Select Model:</label>
                        <select id="emotionModel">
                            <option value="logistic_regression">Logistic Regression</option>
                            <option value="random_forest">Random Forest</option>
                            <option value="naive_bayes">Naive Bayes</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Detect Emotion</button>
                </form>
                <div id="emotionResults" class="results" style="display: none;"></div>
            </div>

            <!-- Model Comparison Section -->
            <div class="card comparison-section">
                <h2>üîç Model Comparison</h2>
                <form id="comparisonForm">
                    <div class="form-group">
                        <label for="comparisonText">Enter text to compare models:</label>
                        <textarea id="comparisonText" placeholder="Type your text here to compare different models..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="comparisonType">Analysis Type:</label>
                        <select id="comparisonType">
                            <option value="sentiment">Sentiment Analysis</option>
                            <option value="emotion">Emotion Detection</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Compare Models</button>
                </form>
                <div id="comparisonResults" class="results" style="display: none;"></div>
            </div>

            <!-- Batch Analysis Section -->
            <div class="card batch-section">
                <h2>üìù Batch Analysis</h2>
                <form id="batchForm">
                    <div class="form-group">
                        <label for="batchTexts">Enter multiple texts (one per line):</label>
                        <textarea id="batchTexts" placeholder="Enter multiple texts here, one per line..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="batchType">Analysis Type:</label>
                        <select id="batchType">
                            <option value="sentiment">Sentiment Analysis</option>
                            <option value="emotion">Emotion Detection</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="batchModel">Select Model:</label>
                        <select id="batchModel">
                            <option value="logistic_regression">Logistic Regression</option>
                            <option value="random_forest">Random Forest</option>
                            <option value="naive_bayes">Naive Bayes</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Analyze Batch</button>
                </form>
                <div id="batchResults" class="results" style="display: none;"></div>
            </div>

            <!-- Database Section -->
            <div class="card database-section">
                <h2>üóÑÔ∏è Database & Analytics</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="showTab('history')">History</button>
                    <button class="tab" onclick="showTab('statistics')">Statistics</button>
                    <button class="tab" onclick="showTab('search')">Search</button>
                </div>

                <!-- History Tab -->
                <div id="history" class="tab-content active">
                    <div class="database-controls">
                        <div class="form-group">
                            <label for="historyType">Analysis Type:</label>
                            <select id="historyType">
                                <option value="both">Both</option>
                                <option value="sentiment">Sentiment</option>
                                <option value="emotion">Emotion</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="historyLimit">Limit:</label>
                            <select id="historyLimit">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50" selected>50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary" onclick="loadHistory()">Load History</button>
                        <button class="btn btn-success" onclick="exportData()">Export to CSV</button>
                    </div>
                    <div id="historyResults"></div>
                </div>

                <!-- Statistics Tab -->
                <div id="statistics" class="tab-content">
                    <button class="btn btn-info" onclick="loadStatistics()">Load Statistics</button>
                    <div id="statisticsResults"></div>
                </div>

                <!-- Search Tab -->
                <div id="search" class="tab-content">
                    <div class="form-group">
                        <label for="searchTerm">Search Term:</label>
                        <input type="text" id="searchTerm" placeholder="Enter search term...">
                    </div>
                    <div class="database-controls">
                        <div class="form-group">
                            <label for="searchType">Analysis Type:</label>
                            <select id="searchType">
                                <option value="both">Both</option>
                                <option value="sentiment">Sentiment</option>
                                <option value="emotion">Emotion</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary" onclick="searchAnalyses()">Search</button>
                    </div>
                    <div id="searchResults"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API endpoints
        const API_BASE = 'http://localhost:5000/api';

        // Utility functions
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading...</p>
                </div>
            `;
            element.style.display = 'block';
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="error">${message}</div>`;
            element.style.display = 'block';
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="success">${message}</div>`;
            element.style.display = 'block';
        }

        function formatConfidence(confidence) {
            return Math.round(confidence * 100);
        }

        function getSentimentClass(sentiment) {
            switch(sentiment.toLowerCase()) {
                case 'positive': return 'sentiment-positive';
                case 'negative': return 'sentiment-negative';
                case 'neutral': return 'sentiment-neutral';
                default: return '';
            }
        }

        function getEmotionClass(emotion) {
            return `emotion-${emotion.toLowerCase()}`;
        }

        function formatTimestamp(timestamp) {
            return new Date(timestamp).toLocaleString();
        }

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Check server health on page load
        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                if (data.status === 'healthy') {
                    console.log('Server is healthy:', data);
                    // Load initial history
                    loadHistory();
                }
            } catch (error) {
                console.warn('Server health check failed. Make sure the Flask server is running.');
            }
        });

        // Database functions
        async function loadHistory() {
            try {
                const response = await fetch(`${API_BASE}/history?type=both&limit=20`);
                const data = await response.json();
                
                if (response.ok) {
                    displayHistory(data.history);
                } else {
                    console.error('Failed to load history:', data.error);
                }
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }

        function displayHistory(history) {
            const historyDiv = document.getElementById('historyResults');
            if (!historyDiv) return;
            
            if (history.length === 0) {
                historyDiv.innerHTML = '<div class="success">No analysis history found.</div>';
                return;
            }
            
            let tableHTML = `
                <h3>Recent Analysis History</h3>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Text</th>
                            <th>Prediction</th>
                            <th>Confidence</th>
                            <th>Model</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            history.forEach(item => {
                const predictionClass = item.sentiment ? 
                    getSentimentClass(item.sentiment) : 
                    getEmotionClass(item.emotion);
                const prediction = item.sentiment || item.emotion;
                
                tableHTML += `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.text.substring(0, 50)}${item.text.length > 50 ? '...' : ''}</td>
                        <td class="${predictionClass}">${prediction}</td>
                        <td>${formatConfidence(item.confidence)}%</td>
                        <td>${item.model_type}</td>
                        <td>${formatTimestamp(item.timestamp)}</td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table>';
            historyDiv.innerHTML = tableHTML;
        }

        async function loadStatistics() {
            try {
                const response = await fetch(`${API_BASE}/statistics`);
                const data = await response.json();
                
                if (response.ok) {
                    displayStatistics(data);
                } else {
                    console.error('Failed to load statistics:', data.error);
                }
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        function displayStatistics(stats) {
            const statsDiv = document.getElementById('statisticsResults');
            if (!statsDiv) return;
            
            let html = '<div class="stats-grid">';
            
            html += `
                <div class="stat-card">
                    <div class="stat-number">${stats.total_sentiment_analyses || 0}</div>
                    <div class="stat-label">Total Sentiment Analyses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.total_emotion_analyses || 0}</div>
                    <div class="stat-label">Total Emotion Analyses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.avg_sentiment_confidence || 0}%</div>
                    <div class="stat-label">Avg Sentiment Confidence</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.avg_emotion_confidence || 0}%</div>
                    <div class="stat-label">Avg Emotion Confidence</div>
                </div>
            `;
            
            html += '</div>';
            
            if (stats.sentiment_distribution && Object.keys(stats.sentiment_distribution).length > 0) {
                html += '<h3>Sentiment Distribution</h3><div class="stats-grid">';
                Object.entries(stats.sentiment_distribution).forEach(([sentiment, count]) => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-number">${count}</div>
                            <div class="stat-label ${getSentimentClass(sentiment)}">${sentiment}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (stats.emotion_distribution && Object.keys(stats.emotion_distribution).length > 0) {
                html += '<h3>Emotion Distribution</h3><div class="stats-grid">';
                Object.entries(stats.emotion_distribution).forEach(([emotion, count]) => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-number">${count}</div>
                            <div class="stat-label ${getEmotionClass(emotion)}">${emotion}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            statsDiv.innerHTML = html;
        }

        async function searchAnalyses() {
            const searchTerm = document.getElementById('searchTerm').value;
            const type = document.getElementById('searchType').value;
            
            if (!searchTerm.trim()) {
                showError('searchResults', 'Please enter a search term');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(searchTerm)}&type=${type}`);
                const data = await response.json();
                
                if (response.ok) {
                    displaySearchResults(data);
                } else {
                    showError('searchResults', data.error || 'Search failed');
                }
            } catch (error) {
                showError('searchResults', 'Network error. Please check if the server is running.');
            }
        }

        function displaySearchResults(data) {
            const element = document.getElementById('searchResults');
            
            if (data.results.length === 0) {
                element.innerHTML = `<div class="success">No results found for "${data.search_term}"</div>`;
                return;
            }
            
            let tableHTML = `
                <h3>Search Results for "${data.search_term}" (${data.total} found)</h3>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Text</th>
                            <th>Prediction</th>
                            <th>Confidence</th>
                            <th>Model</th>
                            <th>Type</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.results.forEach(item => {
                const predictionClass = item.analysis_type === 'sentiment' ? 
                    getSentimentClass(item.prediction) : getEmotionClass(item.prediction);
                
                tableHTML += `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.text.substring(0, 50)}${item.text.length > 50 ? '...' : ''}</td>
                        <td class="${predictionClass}">${item.prediction}</td>
                        <td>${formatConfidence(item.confidence)}%</td>
                        <td>${item.model_type}</td>
                        <td>${item.analysis_type}</td>
                        <td>${formatTimestamp(item.timestamp)}</td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table>';
            element.innerHTML = tableHTML;
        }

        async function exportData() {
            try {
                const response = await fetch(`${API_BASE}/export`);
                const data = await response.json();
                
                if (response.ok) {
                    showSuccess('historyResults', `Data exported successfully to ${data.filename}`);
                } else {
                    showError('historyResults', data.error || 'Export failed');
                }
            } catch (error) {
                showError('historyResults', 'Export failed. Please check if the server is running.');
            }
        }

        // Sentiment Analysis
        document.getElementById('sentimentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const text = document.getElementById('sentimentText').value;
            const modelType = document.getElementById('sentimentModel').value;
            
            if (!text.trim()) {
                showError('sentimentResults', 'Please enter some text to analyze.');
                return;
            }

            showLoading('sentimentResults');

            try {
                const response = await fetch(`${API_BASE}/sentiment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text, model_type: modelType })
                });

                const data = await response.json();

                if (response.ok) {
                    const resultsDiv = document.getElementById('sentimentResults');
                    resultsDiv.innerHTML = `
                        <div class="result-item">
                            <div class="result-label">ID:</div>
                            <div class="result-value">${data.id}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Original Text:</div>
                            <div class="result-value">${data.text}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Processed Text:</div>
                            <div class="result-value">${data.processed_text}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Sentiment:</div>
                            <div class="result-value ${getSentimentClass(data.sentiment)}">${data.sentiment.toUpperCase()}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Confidence:</div>
                            <div class="result-value">${formatConfidence(data.confidence)}%</div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${formatConfidence(data.confidence)}%"></div>
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Model Used:</div>
                            <div class="result-value">${data.model_type.replace('_', ' ').toUpperCase()}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Timestamp:</div>
                            <div class="result-value">${formatTimestamp(data.timestamp)}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Probabilities:</div>
                            <div class="result-value">
                                ${Object.entries(data.probabilities).map(([label, prob]) => 
                                    `<div>${label}: ${formatConfidence(prob)}%</div>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                    resultsDiv.style.display = 'block';
                } else {
                    showError('sentimentResults', data.error || 'An error occurred during analysis.');
                }
            } catch (error) {
                showError('sentimentResults', 'Network error. Please check if the server is running.');
            }
        });

        // Emotion Detection
        document.getElementById('emotionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const text = document.getElementById('emotionText').value;
            const modelType = document.getElementById('emotionModel').value;
            
            if (!text.trim()) {
                showError('emotionResults', 'Please enter some text to analyze.');
                return;
            }

            showLoading('emotionResults');

            try {
                const response = await fetch(`${API_BASE}/emotion`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text, model_type: modelType })
                });

                const data = await response.json();

                if (response.ok) {
                    const resultsDiv = document.getElementById('emotionResults');
                    resultsDiv.innerHTML = `
                        <div class="result-item">
                            <div class="result-label">ID:</div>
                            <div class="result-value">${data.id}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Original Text:</div>
                            <div class="result-value">${data.text}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Processed Text:</div>
                            <div class="result-value">${data.processed_text}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Detected Emotion:</div>
                            <div class="result-value ${getEmotionClass(data.emotion)}">${data.emotion.toUpperCase()}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Confidence:</div>
                            <div class="result-value">${formatConfidence(data.confidence)}%</div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${formatConfidence(data.confidence)}%"></div>
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Model Used:</div>
                            <div class="result-value">${data.model_type.replace('_', ' ').toUpperCase()}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Timestamp:</div>
                            <div class="result-value">${formatTimestamp(data.timestamp)}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Probabilities:</div>
                            <div class="result-value">
                                ${Object.entries(data.probabilities).map(([label, prob]) => 
                                    `<div>${label}: ${formatConfidence(prob)}%</div>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                    resultsDiv.style.display = 'block';
                } else {
                    showError('emotionResults', data.error || 'An error occurred during analysis.');
                }
            } catch (error) {
                showError('emotionResults', 'Network error. Please check if the server is running.');
            }
        });

        // Model Comparison
        document.getElementById('comparisonForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const text = document.getElementById('comparisonText').value;
            const analysisType = document.getElementById('comparisonType').value;
            
            if (!text.trim()) {
                showError('comparisonResults', 'Please enter some text to compare.');
                return;
            }

            showLoading('comparisonResults');

            try {
                const response = await fetch(`${API_BASE}/compare_models`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text, analysis_type: analysisType })
                });

                const data = await response.json();

                if (response.ok) {
                    const resultsDiv = document.getElementById('comparisonResults');
                    let tableHTML = `
                        <div class="result-item">
                            <div class="result-label">Text:</div>
                            <div class="result-value">${data.text}</div>
                        </div>
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Model</th>
                                    <th>Prediction</th>
                                    <th>Confidence</th>
                                    <th>Probabilities</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    Object.entries(data.results).forEach(([model, result]) => {
                        const predictionClass = analysisType === 'sentiment' ? 
                            getSentimentClass(result.prediction) : 
                            getEmotionClass(result.prediction);
                        
                        tableHTML += `
                            <tr>
                                <td><strong>${model.replace('_', ' ').toUpperCase()}</strong></td>
                                <td class="${predictionClass}">${result.prediction.toUpperCase()}</td>
                                <td>${formatConfidence(result.confidence)}%</td>
                                <td>
                                    ${Object.entries(result.probabilities).map(([label, prob]) => 
                                        `${label}: ${formatConfidence(prob)}%`
                                    ).join('<br>')}
                                </td>
                            </tr>
                        `;
                    });

                    tableHTML += `
                            </tbody>
                        </table>
                    `;
                    
                    resultsDiv.innerHTML = tableHTML;
                    resultsDiv.style.display = 'block';
                } else {
                    showError('comparisonResults', data.error || 'An error occurred during comparison.');
                }
            } catch (error) {
                showError('comparisonResults', 'Network error. Please check if the server is running.');
            }
        });

        // Batch Analysis
        document.getElementById('batchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const texts = document.getElementById('batchTexts').value.split('\n').filter(text => text.trim());
            const analysisType = document.getElementById('batchType').value;
            const modelType = document.getElementById('batchModel').value;
            
            if (texts.length === 0) {
                showError('batchResults', 'Please enter some texts to analyze.');
                return;
            }

            showLoading('batchResults');

            try {
                const response = await fetch(`${API_BASE}/batch_analysis`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        texts, 
                        analysis_type: analysisType,
                        model_type: modelType 
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    const resultsDiv = document.getElementById('batchResults');
                    let resultsHTML = `
                        <div class="result-item">
                            <div class="result-label">Batch ID:</div>
                            <div class="result-value">${data.batch_id}</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Analysis Summary:</div>
                            <div class="result-value">
                                Analyzed ${data.total_texts} texts using ${data.model_type.replace('_', ' ').toUpperCase()} for ${data.analysis_type}
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Timestamp:</div>
                            <div class="result-value">${formatTimestamp(data.timestamp)}</div>
                        </div>
                        <div class="batch-results">
                    `;

                    data.results.forEach((result, index) => {
                        const predictionClass = analysisType === 'sentiment' ? 
                            getSentimentClass(result.prediction) : 
                            getEmotionClass(result.prediction);
                        
                        resultsHTML += `
                            <div class="result-item">
                                <div class="result-label">Text ${index + 1}:</div>
                                <div class="result-value">${result.text}</div>
                                <div class="result-label">Prediction:</div>
                                <div class="result-value ${predictionClass}">${result.prediction.toUpperCase()}</div>
                                <div class="result-label">Confidence:</div>
                                <div class="result-value">${formatConfidence(result.confidence)}%</div>
                            </div>
                        `;
                    });

                    resultsHTML += '</div>';
                    resultsDiv.innerHTML = resultsHTML;
                    resultsDiv.style.display = 'block';
                } else {
                    showError('batchResults', data.error || 'An error occurred during batch analysis.');
                }
            } catch (error) {
                showError('batchResults', 'Network error. Please check if the server is running.');
            }
        });
    </script>
</body>
</html> 